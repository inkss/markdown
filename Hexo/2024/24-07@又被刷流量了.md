---
seo_title: CDN 流量又被刷了
toc: true
indent: true
tag:
  - CDN
  - 腾讯云
categories: 杂谈
date: '2024-07-24 18:10'
updated: '2024-07-24 20:56'
hidden: false
description: 怎么能有那么蛋疼的人，动不动就刷人流量啊。
abbrlink: '70023975'
headimg: ../../img/article/24-07@又被刷流量了/Hexo博客封面.png
---

![CDN 流量又被刷了](../../img/article/24-07@又被刷流量了/Hexo博客封面.png)

## 缘由

实在是太大意了，一个不太常用的域名，在 CDN 域名配置里只设置了用量封顶，没有配置访问限频和下行限速。同时用量封顶又有个缓存，不能即时生效，在封顶生效关闭域名前的时间差里任人宰割了。

![总量](../../img/article/24-07@又被刷流量了/24-07-24_174024.png)

![流量](../../img/article/24-07@又被刷流量了/24-07-24_175011.png)

![IP](../../img/article/24-07@又被刷流量了/24-07-24_174924.png)

从 21:40 开始，到 22:05 封顶结束，7.62w 次请求，对一个仅仅 400K 的图片文件刷出了 18.19GB 流量，真是混蛋啊，具体的到文件为友链头像文件，完全无法理解对方意图何在。

## 改进

痛定思痛，粗放式的域名配置隐患太大了，此前因为加速域名太多没有细致配置，随翻了下腾讯云 API，照例写个 Node 脚本，批量修改。

统一标准：

- 共用 IP 黑名单/ UA 黑名单；
- IP 访问限频：30QPS；
- 下行限速配置：5120kb/s；
- 用量封顶：5GB、24 小时、关闭 CDN。

项目地址：

{% link inkss/t-cdn-update, https://github.com/inkss/t-cdn-update %}

## 列表

### IP 黑名单列表{% emoji fennu %}

| IP                | 地址               | 运营商   | 损失流量 | 攻击时间   |
| ----------------- | ------------------ | -------- | -------- | ---------- |
| 60.221.195.20&163 | 中国 山西省 临汾市 | 中国联通 | 18.19GB  | 2024/07/22 |
| 60.220.182.16     | 中国 山西省 长治市 | 中国联通 | 4.36GB   | 2024/07/24 |

### UA 黑名单列表

- `*nmap*|*NMAP*|*HTTrack*|*sqlmap*|*Java*|*zgrab*`
- `*Python*|*python*|*curl*l*Curl*|*wget|*Wget*`
- `*MJ12bot*|*a Palo Alto*|*ltx71*|*censys*|*AhrefsBot*`
- `*Go-http-client*|*CensysInspect*|*toutiao*|*Barkrowler*`
