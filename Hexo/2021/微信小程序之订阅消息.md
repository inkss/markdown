---
title: 微信小程序之订阅消息
toc: true
indent: true
comments: true
archive: true
cover: false
mathjax: false
pin: false
top_meta: true
bottom_meta: true
tag:
  - 微信小程序
  - 订阅消息
categories: 小程序
keywords: [微信小程序, 订阅消息]
description: 本文记录了在使用订阅消息时所踩的坑，主要基于一次性订阅消息展开，涉及用户订阅状态判断，通知权限处理等。
icons:
  - fab fa-weixin green
references:
  - title: 小程序订阅消息
    url: 'https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/subscribe-message.html'
abbrlink: 5e967ba
date: 2021-05-05 23:09:56
updated: 2021-05-05 23:09:56
---

{% noteblock quote, 订阅消息 %}
消息能力是小程序能力中的重要组成，我们为开发者提供了订阅消息能力，以便实现服务的闭环和更优的体验。

- 订阅消息推送位置：服务通知
- 订阅消息下发条件：用户自主订阅
- 订阅消息卡片跳转能力：点击查看详情可跳转至该小程序的页面

{% endnoteblock %}

## 一、前言

订阅消息有两种类型：**一次性订阅消息** 和 **长期订阅消息** ，长期性订阅消息仅向政务民生、医疗、交通、金融、教育等线下公共服务开放，一般用户无法申请到。本文着重于一次性订阅，按照官网文档中的定义：

{% note info, 一次性订阅消息用于解决用户使用小程序后，后续服务环节的通知问题。用户自主订阅后，开发者可不限时间地下发一条对应的服务消息；每条消息可单独订阅或退订。 %}

服务端通过调用 `subscribeMessage.send` 接口发送消息，对于服务端来说，也只能做到调用 Api ，然后接收到返回值。在他的错误返回值中对失败的判断有这么一条：

*3101	用户拒绝接受消息，如果用户之前曾经订阅过，则表示用户取消了订阅关系。*

