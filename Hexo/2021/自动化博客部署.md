---
title: 自动化博客部署
toc: true
indent: true
tag:
  - Hexo
  - Gitea
  - Github Action
categories: 教程
date: '2021-07-25 03:09'
updated: '2021-07-25 03:09'
abbrlink: 42987b6b
background: /img/article/自动化博客部署/wallhaven-48o37j.png
references:
  - title: '使用 SSH 连接到 Github'
    url: 'https://docs.github.com/cn/github/authenticating-to-github/connecting-to-github-with-ssh'
  - title: '生成新 GPG 密钥'
    url: 'https://docs.github.com/cn/github/authenticating-to-github/managing-commit-signature-verification/generating-a-new-gpg-key'
  - title: '震惊！竟然有人在 GitHub 上冒充我的身份！'
    url: 'https://blog.spencerwoo.com/2020/08/wait-this-is-not-my-commit'
---

<div class="img-wrap">
  <div class="img-bg" style="background:var(--color-card)">
    <img class="img" src="../../img/article/自动化博客部署/Hexo部署.svg" alt="博客部署流程" style="max-height: 800px;">
  </div>
  <span class="image-caption">博客部署流程</span>
</div>

<!-- more -->

本文记录了 **枋柚梓的猫会发光** 的部署过程，基本概括来说就是通过 Github Action 处理代码的提交，部署博客到 Github、Gitea、OSS 中，此外还包含一些 GPG 的签名提交、自托管主机遇到的一些坑和一些其它功能的使用过程。

<br>

{% noteblock quote, 本文共包含以下内容： %}

- SSH 私钥提交
- GPG 部署与代码签名
- Github Action 基本语法规则
- Github Action 自托管主机使用
- Gitea 的 Webhook 及本地代码同步
- 利用 Gulp 批量替换静态资源访问地址
- 腾讯云 OSS 部署及 CDN 缓存刷新

{% endnoteblock %}

## 一、本地代码提交

### 使用 SSH 连接到 Github

基本流程就是：生成密钥，将公钥上传到 Github ，参考此链接操作：[使用 SSH 连接到 Github](https://docs.github.com/cn/github/authenticating-to-github/connecting-to-github-with-ssh) 。

### 使用 GPG 对提交进行签名

对于 Linux 用户，系统已经默认安装了 GPG ，直接使用即可；Windows 用户可以下载 GPG 的 [命令行工具](https://www.gnupg.org/download/) ，当然最简单的还是利用 [Scoop](/page/notes/shell/#Scoop-安装、部署、下载) 安装：

```shell Windows 安装 scoop
scoop install gpg
```

安装完成之后就是生成 GPG 密钥对，生成过程参考此链接操作：[生成新 GPG 密钥](https://docs.github.com/cn/github/authenticating-to-github/managing-commit-signature-verification/generating-a-new-gpg-key) 。

如果已有 GPG 密钥是可以直接导入，这点比 SSH 密钥的导入导出方便很多，下面是查看系统中已有的密钥和对其导入导出的命令：

```bash 列出您拥有其公钥和私钥
➜  ~ gpg --list-secret-keys --keyid-format=long 
/root/.gnupg/pubring.kbx
------------------------
sec   rsa4096/705CF548160B570E 2021-07-25 [SC]
      3B21B65778AD1331E052020D705CF548160B570E
uid                 [ultimate] inkss (inkss) <me@szyink.com>
ssb   rsa4096/0C85BC5AF8B7CF09 2021-07-25 [E]
➜  ~ gpg --list-keys --keyid-format=long 
/root/.gnupg/pubring.kbx
------------------------
pub   rsa4096/705CF548160B570E 2021-07-25 [SC]
      3B21B65778AD1331E052020D705CF548160B570E
uid                 [ultimate] inkss (inkss) <me@szyink.com>
sub   rsa4096/0C85BC5AF8B7CF09 2021-07-25 [E]
```

其中，ses 和 pub 后跟的字符串为对应 ID，例如本例中 GPG 密钥 ID 为 `705CF548160B570E`。

```bash 导出私钥时需要验证私钥密码
➜  ~ gpg -a -o gpg-public.key --export 705CF548160B570E
➜  ~ gpg -a -o gpg-private.key --export-secret-keys 705CF548160B570E
```

相应的导入密钥命令如下，同样导入私钥时需要输入密码。

```bash 导入私钥/公钥到系统中
➜  ~ gpg --import gpg-public.key 
gpg: key 705CF548160B570E: public key "inkss (inkss) <me@szyink.com>" imported
gpg: Total number processed: 1
gpg:               imported: 1
➜  ~ gpg --import gpg-private.key 
gpg: key 705CF548160B570E: "inkss (inkss) <me@szyink.com>" not changed
gpg: key 705CF548160B570E: secret key imported
gpg: Total number processed: 1
gpg:              unchanged: 1
gpg:       secret keys read: 1
gpg:   secret keys imported: 1
```

当密钥导入到系统后，需要配置 Git 命令调用 GPG 签名：

```bash 配置 GPG 密钥 ID 并开启全局 GPG 签名验证
➜  ~ git config --global user.signingkey 705CF548160B570E
➜  ~ git config --global commit.gpgsign true
```

-----

未完待续...
