---
title: å°ç«™æ¬å®¶è®°
toc: true
indent: true
tag:
  - ç½‘ç«™
  - Linux
categories: åšå®¢
date: '2021-06-18 01:25'
updated: '2021-06-20 18:00'
abbrlink: 56dd46d6
description: ä»é˜¿é‡Œäº‘è¿åˆ°è…¾è®¯äº‘äº†ï¼Œä»æœåŠ¡å™¨è¿åˆ°è½»é‡æœåŠ¡å™¨äº†ï¼Œä»è¾½å¤‡è¿åˆ°çš–å¤‡äº†ã€‚
headimg: ../../img/article/å°ç«™æ¬å®¶è®°/main.png
background: ../../img/article/å°ç«™æ¬å®¶è®°/wallhaven-4oxlzp.jpg
hideTitle: false
---

ä»é˜¿é‡Œäº‘è¿åˆ°è…¾è®¯äº‘äº†ï¼Œä»æœåŠ¡å™¨è¿åˆ°è½»é‡æœåŠ¡å™¨äº†ï¼Œä»è¾½å¤‡è¿åˆ°çš–å¤‡äº†ã€‚å¿ƒè·¯å†ç¨‹å¯ä»¥å‚è§è¿™ç¯‡æ–‡ç« ï¼š[å°ç«™çš„æ¬å®¶ç»å†](https://szyink.com/archives/702/)ã€‚æ­¤å¤„è®°å½•æ¬å®¶å†å²ã€‚å¯¹äºåŠ¨æ€ç½‘ç«™ï¼Œæ¬å®¶æ— éå°±æ˜¯ä¸¤ä»¶äº‹ï¼Œæ¬ç½‘ç«™ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶å’Œæ¬æ•°æ®åº“ï¼Œä¸€èˆ¬æ¥è¯´è¿ç§»å®Œè¿™ä¿©åŸºæœ¬å°±å¥½ä½¿äº†ã€‚ä½†æ˜¯æˆ‘çš„æ–°æ—§æœåŠ¡å™¨åŸºç¡€ç¯å¢ƒä¸ä¸€è‡´ï¼š

*æœåŠ¡å™¨ä» CentOS 7.8 æ¢æˆäº† 8.4ï¼ŒPHP ä» 7.2 æ¢æˆäº† 8.0ï¼Œ Nginx å‡çº§åˆ°äº† 1.20ï¼Œ æ•°æ®åº“å‡çº§åˆ°äº† 10.5.6 çš„æ ·å­ã€‚*

Typecho æ­£å¼ç‰ˆçœŸçš„å¥½ä¹…æ²¡æ›´æ–°äº†ï¼Œéƒ½æ€€ç–‘ä¸æ”¯æŒè¿™ä¸ª PHP ç‰ˆæœ¬ï¼Œäºæ˜¯å°±é€‰æ‹©äº†æ–°è£…å¼€å‘ç‰ˆï¼Œé™¤äº† `/usr` ç›®å½•è¿›è¡Œäº†æ›¿æ¢ä¹‹å¤–ï¼Œå…¶ä½™å†…å®¹å‡æ²¡æœ‰ä¿®æ”¹ã€‚æ•°æ®åº“è¿™è¾¹å®å¡”å¯¼å‡ºæ¥çš„å¤‡ä»½æ–‡ä»¶å…¶å®æ˜¯å«å»ºåº“è¿‡ç¨‹çš„ SQL è„šæœ¬ã€‚æ‰€ä»¥è¿ç§»ç½‘ç«™ä¼¼ä¹ç¡®å®æ²¡å•¥ï¼Œå³ä½¿ç¯å¢ƒä¸ä¸€è‡´ã€‚

å“ˆï¼Œç¢ç¢å¿µç»“æŸï¼Œç½‘ç«™ç¡®å®æ²¡å•¥ï¼Œä¸»è¦æ˜¯åº”ç”¨ç¯å¢ƒæ²¡äº†ï¼Œè¿™ç‚¹æœ‰ç‚¹çƒ¦äººï¼Œé‡æ–°é…ç½®çœŸæ¶ˆç£¨æ—¶é—´ã€‚

## æœåŠ¡å™¨åˆå§‹é…ç½®

### ç³»ç»Ÿåˆå§‹é…ç½®

åœ¨è…¾è®¯äº‘æ§åˆ¶å°é‡ç½® root å¯†ç ï¼Œä»¥åŠé…ç½®å¯†é’¥å’Œå¼€æ”¾é˜²ç«å¢™ï¼ˆåæœŸä½¿ç”¨å®å¡”è‡ªå¸¦çš„é˜²ç«å¢™ï¼‰ã€‚å¯†é’¥è‡ªå·±ä¸Šä¼ è¿›å»ä¹Ÿè¡Œï¼Œç”¨å®å¡”çš„ SSH ç®¡ç†é¡µå¯ä»¥ã€‚

```sh ç³»ç»Ÿåˆå§‹åŒ–
# ç³»ç»Ÿå‡çº§
yum update

# å®‰è£…å¸¸ç”¨è½¯ä»¶
yum install git zsh wget vim

# å®‰è£… oh-my-zsh
sh -c "$(wget -O- https://cdn.jsdelivr.net/gh/robbyrussell/oh-my-zsh/tools/install.sh)"
```

### å®‰è£…å®å¡”é¢æ¿

å…³äºé¢æ¿ SSLï¼Œæ­¤å¤„æˆ‘è¿™é‡Œå‡ºäº†é—®é¢˜ï¼Œç”³è¯·è¯ä¹¦æ—¶ä¸€ç›´æŠ¥é”™ï¼Œåªèƒ½å…ˆä½¿ç”¨è‡ªç­¾è¯ä¹¦ï¼Œç„¶åå°†ä¸»åŸŸåçš„è¯ä¹¦æ–‡ä»¶è½¯é“¾æ¥åˆ°å®å¡”é¢æ¿è¯ä¹¦å¤„ã€‚å¦‚æœèƒ½åœ¨å¼€å¯ SSL å¤„ç”³è¯·æˆåŠŸé‚£è‡ªç„¶æœ€å¥½ã€‚

```sh é›·å³°å¡”ä¸­æœ‰ç™½è›‡
# å®‰è£…é¢æ¿
yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh

# æ·¦æ‰è´¦æˆ·ç™»å½•æ ¡éªŒ
rm -f /www/server/panel/data/bind.pl

# ä¸»åŸŸååšå®¢ç”¨ï¼Œåˆ†é…äºŒçº§åŸŸåç»‘å®šå®å¡”ã€‚
# ä¸»åŸŸåç”³è¯·æ³›åŸŸåè¯ä¹¦ï¼Œå®å¡”é¢æ¿å¼€å¯ SSLï¼Œä¿®æ”¹è¯ä¹¦è·¯å¾„çš„ä¸»åŸŸåè¯ä¹¦å¤„ã€‚
ln /www/server/panel/vhost/cert/szyink.com/privkey.pem /www/server/panel/ssl/privateKey.pem
ln /www/server/panel/vhost/cert/szyink.com/fullchain.pem /www/server/panel/ssl/certificate.pem
```

### é¢„è£…åº”ç”¨åˆ é™¤

```sh å¹²ç¿»ç›‘æ§
# æ•´ä½“åˆ é™¤ qcloud å†…å®¹ï¼Œç„¶åé‡å¯
# æµ‹è¯•ååˆ é™¤è¿™ä¸ªä¸å½±å“å¿«ç…§çš„æ–°å»ºå’Œæ¢å¤
rm -rf /usr/local/qcloud

# æˆ–è€…æ˜¯ä½¿ç”¨å¸è½½å‘½ä»¤
/usr/local/qcloud/stargate/admin/uninstall.sh
/usr/local/qcloud/monitor/barad/admin/uninstall.sh

# æŸ¥æ‰¾æ˜¯å¦æ®‹ç•™è¿›ç¨‹
ps -A | grep agent

# åˆ é™¤é¢„ç½®è´¦æˆ·
userdel -r lighthouse
```

## åº”ç”¨å®‰è£…

### å®‰è£… Docker

```sh æ–‡æ¡£åœ°å€ï¼šhttps://docs.docker.com/engine/install/centos/
# ç§»é™¤å¯èƒ½çš„æ—§ç‰ˆæœ¬
yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine

# å®‰è£… yum-utils åŒ…å¹¶è®¾ç½®ç¨³å®šç‰ˆå­˜å‚¨åº“
yum install -y yum-utils
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

# å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Docker å¼•æ“
yum install docker-ce docker-ce-cli containerd.io

# å¯åŠ¨ Docker
systemctl start docker
```

- æ–°å»ºä¸€ä¸ª coder ç”¨æˆ·ä»¥æ–¹ä¾¿æ­å»º codeï¼serverï¼ˆroot è´¦æˆ·ä¸‹æ‰§è¡Œï¼‰

```sh coder ç”¨æˆ·
# æ–°å»ºç”¨æˆ·
useradd -m coder

# ä¸ºæ–°ç”¨æˆ·è®¾ç½®å¯†ç 
passwd coder

# å°†æ–°ç”¨æˆ·æ·»åŠ åˆ° docker ç»„
gpasswd -a coder docker
```

- é…ç½® coder ç”¨æˆ·

```sh åœ¨ coder ç”¨æˆ·ä¸­æ‰§è¡Œï¼ˆdockerï¼‰
# å‚è€ƒä¸Šæ–‡æ›´æ¢ shell ä¸º oh-my-zsh

# å®‰è£… nvmï¼Œå‚è€ƒæç¤ºé…ç½®ç¯å¢ƒå˜é‡å¹¶åˆ·æ–°
wget -qO- https://cdn.jsdelivr.net/gh/creationix/nvm/install.sh | sh
source .zshrc

# å®‰è£… node & hexo
nvm install --lts
npm install hexo-cli -g

# é…ç½® ssh
```

### å®‰è£… Cloudreve

å®å¡”æ–°å»ºä¸€ä¸ªç”¨æˆ·è®¿é—® Cloudreve çš„ç«™ç‚¹ï¼Œå°† Cloudreve çš„å®‰è£…åŒ…ä¸Šä¼ åˆ°ç½‘ç«™ç›®å½•ã€‚åŒæ—¶åœ¨è¯¥ç›®å½•ä¸‹æ–°å»º `conf.ini` é…ç½®æ–‡ä»¶ï¼Œç”¨ä»¥ä¿®æ”¹ç›‘å¬ç«¯å£ï¼Œé¡ºå¸¦å°†å­˜å‚¨ç±»å‹ä» sqlite æ¢æˆ mysqlã€‚

```inl é…ç½®æ–‡ä»¶åœ°å€ï¼šhttps://docs.cloudreve.org/getting-started/config
[System]
Mode = master
Listen = :5212
SessionSecret = ******
HashIDSalt = ******

; æ•°æ®åº“ç›¸å…³ï¼Œå¦‚æœä½ åªæƒ³ä½¿ç”¨å†…ç½®çš„ SQLiteæ•°æ®åº“ï¼Œè¿™ä¸€éƒ¨åˆ†ç›´æ¥åˆ å»å³å¯
[Database]
; æ•°æ®åº“ç±»å‹ï¼Œç›®å‰æ”¯æŒ sqlite | mysql
Type = mysql
; MySQL ç«¯å£
Port = 3306
; ç”¨æˆ·å
User = cloudreve
; å¯†ç 
Password = TdCP87HJaE8yyXKD
; æ•°æ®åº“åœ°å€
Host = 127.0.0.1
; æ•°æ®åº“åç§°
Name = cloudreve
; æ•°æ®è¡¨å‰ç¼€
TablePrefix = cd_

```

å®å¡”åº”ç”¨å•†åº—å®‰è£… Supervisord ç®¡ç†å™¨ï¼Œæ·»åŠ å®ˆæŠ¤ç¨‹åºï¼Œå†…å®¹å¦‚ä¸‹ï¼š

{% image ../../img/article/å°ç«™æ¬å®¶è®°/image-20210620174605046.png, alt='æ·»åŠ å®ˆæŠ¤ç¨‹åº', height=400px%}

ç§»é™¤åˆ°æ—¥å¿—æŸ¥çœ‹ï¼Œè·å–åˆå§‹çš„è´¦æˆ·å’Œå¯†ç ï¼Œç„¶åç™»é™†å·´æ‹‰å·´æ‹‰ã€‚

- æ­é… Aria2 å®ç°ç¦»çº¿ä¸‹è½½

æ­¤å¤„æˆ‘é€‰æ‹©äº†ç¼–è¯‘å®‰è£…ï¼Œä» [Github](https://github.com/aria2/aria2/releases) ä¸‹è½½å‘è¡Œç‰ˆï¼Œåˆ©ç”¨å®å¡”ä¸Šä¼ åˆ°éšä¾¿ä¸€ä¸ªçœ‹ç€èˆ’å¿ƒçš„ç›®å½•ã€‚

```sh å‚è€ƒ readme.md æ–‡ä»¶å†…å®¹è¿›è¡Œç¼–è¯‘å®‰è£…
autoreconf -i
./configure ARIA2_STATIC=yes
make
```

æ¥ç€åœ¨éšä¾¿ä¸€ä¸ªçœ‹ç€èˆ’å¿ƒçš„ä½ç½®æ–°å»ºé…ç½®æ–‡ä»¶ï¼Œå†…å®¹æ ¹æ®ä¸ªäººéœ€æ±‚è€Œå®šã€‚PSï¼šå…³äºåšç§ï¼ŒCloudreve å»ºç«‹çš„ç¦»çº¿ä¸‹è½½åªæœ‰åœ¨æ»¡è¶³åšç§æ¡ä»¶åæ‰ä¼šå°†æ–‡ä»¶ä»ä¸´æ—¶ç›®å½•ç§»åˆ°å­˜å‚¨ç›®å½•ï¼Œæ‰€ä»¥çƒ­é—¨èµ„æºè¿˜å¥½ï¼Œå†·é—¨èµ„æºçš„è¯å¯èƒ½ä¼šç”±äºå¾ˆå°‘æœ‰äººä¸‹è½½æ»¡è¶³ä¸äº†åšç§æ¡ä»¶ï¼Œè¿™é‡Œæˆ‘å»ºè®®åšç§ç»ˆæ­¢æ¡ä»¶é™¤äº†åˆ†äº«ç‡å¤–å†æ·»ä¸Šåšç§æ—¶é—´ã€‚

å¯æ‰§è¡Œæ–‡ä»¶ä½äº `/src/` ç›®å½•ä¸­ï¼Œå¯åŠ¨å‘½ä»¤ï¼š

```sh aria2c
# å¯åŠ¨
./aria2c --conf-path="/ä½ çš„é…ç½®æ–‡ä»¶åœ°å€/aria2.conf" -D

# æŸ¥æ‰¾å¯¹åº” pid 
ps -A | grep aria

# å¼ºåœè½¯ä»¶
kill -9 xxxx
```

æœ€åè·‘åˆ° Cloudreve è®¾ç½®é¡µé¢é…ç½®ä¸€ä¸‹ç¦»çº¿ä¸‹è½½å°±å¥½äº†ã€‚

## é¸½å­ğŸ•Š

~~æœªå®Œå¾…ç»­~~ or é¸½äº†
