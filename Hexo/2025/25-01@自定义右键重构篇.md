---
title: è‡ªå®šä¹‰å³é”®é‡æ„ç¯‡
toc: true
indent: true
hiddenTitle: false
tag:
  - è‡ªå®šä¹‰å³é”®èœå•
  - å‰ç«¯å¼€å‘
  - ç½‘ç«™ä¼˜åŒ–
  - JavaScript
categories: åšå®¢
description: >-
  è¿™ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†å¦‚ä½•é‡æ„è‡ªå®šä¹‰å³é”®èœå•ï¼ŒåŒ…æ‹¬éœ€æ±‚åˆ†æã€é…ç½®æ–‡ä»¶ã€é¡µé¢ç»˜åˆ¶ã€å¤„ç†æµç¨‹ã€åŠŸèƒ½å®ç°å’Œé™„å½•å†…å®¹ã€‚æ–‡ç« é€šè¿‡å…·ä½“ç¤ºä¾‹å’Œä»£ç å±•ç¤ºäº†å¦‚ä½•è®¾è®¡å’Œå®ç°å¯¼èˆªæ å’Œèœå•é¡¹çš„æ˜¾ç¤ºä¸éšè—ã€èœå•çš„å¼¹å‡ºä½ç½®ä»¥åŠèœå•äº‹ä»¶çš„å¤„ç†ã€‚æ–‡ç« è¿˜æä¾›äº†å¤–éƒ¨æ–¹æ³•çš„è°ƒç”¨æ–¹å¼å’Œå®Œæ•´çš„å®ç°ä»£ç ï¼Œé€‚ç”¨äºå‰ç«¯å¼€å‘å’Œç½‘ç«™ä¼˜åŒ–ã€‚
date: '2025-01-21 01:20'
updated: '2025-01-23 23:35'
background: ../../img/article/21-07@è‡ªåŠ¨åŒ–åšå®¢éƒ¨ç½²/wallhaven-48o37j.avif
headimg: ../../img/article/25-01@è‡ªå®šä¹‰å³é”®é‡æ„ç¯‡/Hexoåšå®¢å°é¢.png
abbrlink: 4f48cb48
references:
  - title: åŸç”Ÿ JS çš„å³é”®èœå•å®ç°
    url: https://inkss.cn/post/3717f151
---

æ˜¯çš„ï¼Œè‡ªå®šä¹‰å³é”®èœå•å†æ¬¡å°è¯•é‡æ„äº†ã€‚ä¸Šä¸€æ¬¡é‡æ„æ˜¯åœ¨ 2022 å¹´ï¼Œä½†æœ€è¿‘åœ¨å°è¯•ä¿®æ”¹æ—¶å‘ç°ï¼Œç›®å‰å®ç°é€»è¾‘è¿‡äºå¤æ‚ä¸”ä¸å¤Ÿä¼˜é›…ï¼ŒåŒæ—¶ç”±äºç¼ºä¹åˆé€‚çš„æ³¨é‡Šï¼ŒèŠ±äº†ä¸å°‘æ—¶é—´æ‰ç†æ¸…è°ƒç”¨å…³ç³»ï¼Œ{% emoji kulou %} æƒ­æ„§ã€‚

<!-- more -->

å› æ­¤ï¼Œå†³å®šæ¨å€’é‡æ¥ï¼Œé‡æ–°è®¾è®¡ã€‚

## ä¸€ã€éœ€æ±‚åˆ†æ

èœå•ç±»å‹åˆ†ä¸ºä¸¤ç±»ï¼šå¯¼èˆªæ å’Œèœå•é¡¹ã€‚å¯¼èˆªæ ï¼šä½äºé¡¶éƒ¨ï¼ˆç±»ä¼¼ç«ç‹æµè§ˆå™¨çš„å³é”®èœå•ï¼‰ï¼Œé‡‡ç”¨æ¨ªå‘å¸ƒå±€ï¼Œä»…æ˜¾ç¤ºå›¾æ ‡ã€‚èœå•é¡¹ï¼šé‡‡ç”¨ç«–å‘å¸ƒå±€ï¼Œæ˜¾ç¤ºå›¾æ ‡å’Œèœå•åç§°ï¼Œå¯¹åº”ä¸€èˆ¬çš„æ™®é€šèœå•ã€‚

åŠŸèƒ½ä¸Šä¹Ÿå¯åˆ†ä¸ºä¸¤ç±»ï¼šé“¾æ¥å‹èœå•å’Œäº‹ä»¶å‹èœå•ã€‚é“¾æ¥å‹èœå•ï¼šè®°å½•ç½‘å€å’Œé“¾æ¥ç±»å‹ï¼Œä¾‹å¦‚ï¼šå›åˆ°é¦–é¡µã€æŸ¥çœ‹ç•™è¨€æ¿é¡µé¢ã€‚äº‹ä»¶å‹èœå•ï¼šéœ€è¦æ‰§è¡Œå‡½æ•°çš„èœå•é¡¹ï¼Œä¾‹å¦‚ï¼šå¤åˆ¶æ–‡æœ¬ã€æ‰“å°é¡µé¢ã€‚

è¯¦ç»†åˆ†æè§ä¸‹é¢çš„æ€ç»´å¯¼å›¾ï¼š

![å³é”®èœå•æ€ç»´å¯¼å›¾](../../img/article/25-01@è‡ªå®šä¹‰å³é”®é‡æ„ç¯‡/å³é”®èœå•.svg)

### 1.1 é…ç½®æ–‡ä»¶

```yaml Hexo é…ç½®æ–‡ä»¶ç¤ºä¾‹
rightmenus:
  enable: true
  options:
    navigation: true # æ˜¯å¦æ˜¾ç¤ºå¯¼èˆªæ ç»„ä»¶
    maxMenuItems: 12 # æœ€å¤§èœå•æ˜¾ç¤ºæ•°é‡
  navigation: 
    - { menuItem }
  menuList:
    - { menuItem }
```

`navigation`å’Œ`menuList`å­—æ®µçš„å®šä¹‰é¡ºåºå†³å®šäº†èœå•åŠ è½½çš„æ˜¾ç¤ºé¡ºåºã€‚åœ¨`options`ä¸­ï¼Œ`navigation`æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºå¯¼èˆªæ ç»„ä»¶ï¼›å½“æ»¡è¶³æ¡ä»¶çš„èœå•é¡¹æ•°é‡è¶…è¿‡`maxMenuItems`æ—¶ï¼Œéšè—æ‰€æœ‰é“¾æ¥å‹èœå•ã€‚åœ¨`menuList`èœå•é¡¹ä¸­ï¼Œå¦‚æœç›¸é‚»èœå•é¡¹çš„`displayCondition`å€¼ä¸åŒï¼Œåˆ™è‡ªåŠ¨æ·»åŠ åˆ†å‰²çº¿ã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®šä¹‰èœå•åˆ†å‰²çº¿ï¼Œæ­¤æ—¶è‡ªåŠ¨åˆ¤æ–­ä¼šå…³é—­ï¼Œå¹¶åœ¨å®šä¹‰çš„ä½ç½®æ·»åŠ åˆ†å‰²çº¿ã€‚

```code èœå•åˆ†å‰²çº¿å®šä¹‰æ–¹å¼
hr, {}, {id: 'hr'}
```

å¯¹äº eventName å’Œ displayCondition çš„å€¼ï¼Œå³é”®èœå•å‡½æ•°ä¼šé¢„è®¾ä¸€äº›äº‹ä»¶å’Œåˆ¤æ–­å‡½æ•°ã€‚åœ¨è¿›è¡Œèœå•é¡¹åˆ¤æ–­æˆ–ç‚¹å‡»äº‹ä»¶è§¦å‘æ—¶ï¼Œé¦–å…ˆä¼šæ£€æŸ¥å³é”®èœå•å‡½æ•°ä¸­æ˜¯å¦å­˜åœ¨ç›¸åº”çš„å®ç°ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šåœ¨ window ä¸Šå°è¯•è°ƒç”¨ï¼ŒåŒæ—¶ä¼ é€’ menuItem[^menuItem]ã€event å’Œ pointevent å€¼ã€‚å…·ä½“çš„è°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š

[^menuItem]: æ³¨ï¼šæ­¤å¤„`menuItem`å¯¹è±¡æœªåŒ…å«æ•°æ®ç»„æˆä¸­çš„`name, icon`å±æ€§ï¼Œä½†é¢å¤–æä¾›ä¸¤ä¸ªå±æ€§ï¼š
    ```js
    {
      isHrElement: 'æ˜¯å¦ä¸ºèœå•åˆ†å‰²é¡¹',
      menuContentElement: 'èœå•é¡¹æ‰€å¯¹åº” DOM èŠ‚ç‚¹'
    }
    ```

```js eventName
/**
 * åœ¨ window ä¸Šå°è¯•æŒ‰ç…§ eventName å€¼è°ƒç”¨å‡½æ•°
 * 
 * @param {Object} menuItem èœå•é¡¹
 * @param {Event} event ç‚¹å‡»äº‹ä»¶
 * @param {PointerEvent} pointevent å³é”®äº‹ä»¶
 */
window[eventName](menuItem, event, pointevent)()
```

```js displayCondition
/**
 * åœ¨ window ä¸Šå°è¯•æŒ‰ç…§ displayCondition å€¼è°ƒç”¨å‡½æ•°
 * 
 * @param {Object} menuItem èœå•é¡¹
 * @param {PointerEvent} pointevent å³é”®äº‹ä»¶
 * @returns {Boolean} - true/false æ˜¯å¦å…è®¸å½“å‰èœå•é¡¹æ˜¾ç¤º
 */
window[displayCondition](menuItem, pointevent)()
```

è¯¥è°ƒç”¨æ”¯æŒç®€å•çš„ç‚¹åˆ†é“¾å¼è°ƒç”¨ã€å‚æ•°ä¼ é€’å’Œæ–‡æœ¬æ›¿æ¢ã€‚è¯¦ç»†çš„å®ç°é€»è¾‘è¯·è§ï¼š[3.3 å¤–éƒ¨æ–¹æ³•](#3-3-å¤–éƒ¨æ–¹æ³•)ã€‚

```yaml ä½¿ç”¨ç¤ºä¾‹
- { eventName: 'readMode' } # å†…éƒ¨äº‹ä»¶ï¼šåˆ‡æ¢é˜…è¯»æ¨¡å¼
- { eventName: 'window.location.reload' }  # åˆ·æ–°é¡µé¢
- { eventName: 'volantis.dark.toggle' } # åˆ‡æ¢æ·±è‰²æ¨¡å¼
- { eventName: 'window.open(linkAddress)' } # æ–°æ ‡ç­¾é¡µæ‰“å¼€é“¾æ¥
- { eventName: 'OpenSearch(selectedText)' } # æ‰“å¼€æœç´¢é¡µé¢ï¼Œå¹¶ä¼ é€’å½“å‰é€‰ä¸­æ–‡æœ¬
- { eventName: 'window.open("https://www.bing.com/search?q=##selectedText##")' } # å¿…åº”æœç´¢
```

### 1.2 é¡µé¢ç»˜åˆ¶

menuItem ä¸­çš„å±æ€§å°†ä»¥`data-xxxx`æ ¼å¼å†™å…¥åˆ°èœå•é¡¹çš„ HTML å…ƒç´ ä¸Šã€‚

```html ä¾‹å¤–å±æ€§ï¼š linkTarget â¡ target, link â¡ href
<% if(item.link === undefined) { %>
  <li class="menuLoad-Content">
    <span class="vlts-menu" data-id="<%- item.id %>" data-event-name="<%= item.eventName %>"
      data-display-condition="<%- item.displayCondition %>">
      <i class="<%- item.icon %>"></i>
      <%- item.name %>
    </span>
  </li>
<% } else { %>
  <% if(!item.linkTarget) item.linkTarget = '_self' %>
  <li class="menuLoad-Content">
    <a class="vlts-menu" data-id="<%- item.id %>" href="<%- item.link %>" 
    target="<%- item.linkTarget %>" data-display-condition="<%- item.displayCondition %>">
      <i class="<%- item.icon %>"></i>
      <%- item.name %>
    </a>
  </li>
<% } %>
```

## äºŒã€å¤„ç†æµç¨‹

å¤§è‡´å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š

ğŸ‘ ä½¿ç”¨å³é”®é€‰æ‹©å™¨åœ¨é¡µé¢ä¸­æ‰¾åˆ° HTML å…ƒç´ ã€‚

ğŸ™Œ å¦‚æœæ‰¾åˆ°ï¼Œåˆ™è¯»å–æ‰€æœ‰å¯¼èˆªæ å’Œèœå•é¡¹**èµ‹å€¼**å­˜å‚¨ã€‚

ğŸ¤² è¦†ç›–æµè§ˆå™¨é»˜è®¤çš„å³é”®èœå•ï¼Œ**ç»˜åˆ¶**èœå•é¡¹å¹¶æ˜¾ç¤ºè‡ªå®šä¹‰å³é”®èœå•ã€‚

ğŸ™ ä¸ºå³é”®èœå•ç‚¹å‡»äº‹ä»¶æ·»åŠ äº‹ä»¶å§”æ‰˜ï¼Œè§¦å‘ç›¸åº”**äº‹ä»¶**ã€‚

![å³é”®å¤„ç†æµç¨‹](../../img/article/25-01@è‡ªå®šä¹‰å³é”®é‡æ„ç¯‡/å³é”®å¤„ç†æµç¨‹.svg)

## ä¸‰ã€åŠŸèƒ½å®ç°

å¦‚æœæ˜¯ä¼ ç»Ÿçš„ BS é¡¹ç›®ï¼Œèœå•çš„è¯»å–é€šå¸¸æ˜¯é€šè¿‡è°ƒç”¨ API æ¥å®Œæˆçš„ã€‚è¨€å½’æ­£ä¼ ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä»é¡µé¢ä¸­æŸ¥æ‰¾å³é”®å…ƒç´ åï¼Œåˆ†åˆ«è¯»å–å‡ºå¯¼èˆªæ å’Œèœå•é¡¹ä¸­çš„å…ƒç´ ï¼Œå¹¶å°†å®ƒä»¬èµ‹å€¼ç»™ navigationItems^[navigationItems ä¸»è¦è·å–`id`,`displayCondition`,`menuContentElement`ã€‚] å’Œ menuItemsã€‚

```js
const menuItems = Array.from(menuContainer.querySelectorAll('.menuLoad-Content'))
  .flatMap(item => {
    const elem = item.firstElementChild;
    return elem ? [{
      id: elem.dataset.id,
      link: elem.href,
      linkTarget: elem.target,
      eventName: elem.dataset.eventName,
      displayCondition: elem.dataset.displayCondition,
      isHrElement: elem.tagName === 'HR',
      menuContentElement: item
    }] : [];
  });
```

### 3.1 èœå•ç»˜åˆ¶

ä¸»è¦æ¶‰åŠä¸¤ä¸ªæ–¹é¢ï¼šèœå•é¡¹çš„æ˜¾ç¤ºä¸éšè—ã€èœå•çš„å¼¹å‡ºä½ç½®ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª`conditions`å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«åŸºæœ¬çš„åˆ¤æ–­æ¡ä»¶ï¼Œè¿™äº›æ¡ä»¶çš„æ–¹æ³•è¿”å›å¸ƒå°”å€¼ã€‚è¿™æ ·ï¼Œåªéœ€å°†`displayCondition`çš„å€¼ä¸`conditions`çš„**é”®å€¼**è¿›è¡Œåˆ¤æ–­ï¼Œå³å¯åŒºåˆ†å†…ç½®åˆ¤æ–­æ¡ä»¶å’Œå¤–éƒ¨åˆ¤æ–­æ¡ä»¶ã€‚ç›®å‰å†…ç½®äº†ä»¥ä¸‹åˆ¤æ–­é¡¹ç›®ï¼š

```js
const conditions = {
  inInputField: () => {},
  selectedText: () => {},
  onImage: () => {},
  onLink: () => {},
  articlePage: () => {},
  scrolledFromTop: () => {},
  homePage: () => {}
}
```

æ ¹æ®è®¾å®šï¼Œå¦‚æœ`displayCondition`æœªå®šä¹‰ï¼Œèœå•é¡¹é»˜è®¤æ˜¾ç¤ºã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æ˜¾ç¤ºçš„èœå•é¡¹è¿‡å¤šã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„`maxMenuItems`å€¼æ¥æ§åˆ¶æ˜¾ç¤ºæ•°é‡ã€‚å½“æ˜¾ç¤ºæ•°é‡è¶…è¿‡æ­¤å€¼æ—¶ï¼Œéšè—æ‰€æœ‰é“¾æ¥å‹èœå•é¡¹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºèœå•åˆ†å‰²é¡¹ä¹Ÿéœ€è¦é¢å¤–å¤„ç†ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸¤ç‚¹ï¼š

- å› èœå•é¡¹éšè—è€Œå¯¼è‡´ç›¸é‚»èœå•åˆ†å‰²é¡¹æ˜¾ç¤ºçš„åœºæ™¯ã€‚
- ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªæ˜¾ç¤ºé¡¹ä¸ºèœå•åˆ†å‰²é¡¹çš„åœºæ™¯ã€‚

```js
let lastSeparator = null;
menuItems.forEach(menuItem => {
  const classList = menuItem?.menuContentElement?.classList || null;
  if (menuItem.isHrElement) {
    classList.add('active');
    if (lastSeparator) { lastSeparator.remove('active'); }
    lastSeparator = classList;
  } else if (classList.contains('active')) { lastSeparator = null; }
});
if (lastSeparator) { lastSeparator.remove('active'); }
if (navigationItems.length === 0) {
  const firstActiveMenuItem = menuItems.find(
      item => item.menuContentElement.classList.contains('active'))
  if (firstActiveMenuItem.isHrElement) {
    firstActiveMenuItem.menuContentElement.classList.remove('active');
  }
}
```

æœ€åï¼Œå…³äºèœå•çš„å¼¹å‡ºä½ç½®ï¼Œåªéœ€ç¡®ä¿èœå•æ˜¾ç¤ºåœ¨å±å¹•å†…å³å¯ã€‚å¦ä¸€ä¸ªéœ€è¦è€ƒè™‘çš„æ˜¯ï¼Œå½“ç½‘é¡µå¤„äºç§»åŠ¨ç«¯å¸ƒå±€æ—¶ï¼Œå–æ¶ˆè‡ªå®šä¹‰èœå•è¦†ç›–ã€‚

### 3.2 èœå•äº‹ä»¶

ä¸èœå•ç»˜åˆ¶ç±»ä¼¼ï¼Œæˆ‘ä»¬é€šè¿‡å®šä¹‰å®ç°å¯¹è±¡`eventHandlers`ï¼Œå¹¶æ ¹æ®é”®å€¼æ¥åŒºåˆ†å†…éƒ¨äº‹ä»¶å’Œå¤–éƒ¨äº‹ä»¶ã€‚

```js
/**
 * äº‹ä»¶è°ƒç”¨
 * 
 * @param {string} id äº‹ä»¶ id
 * @param {string} eventName äº‹ä»¶åç§°
 * @param {Event} event ç‚¹å‡»äº‹ä»¶
 */
const handleEvent = (id, eventName, event) => {
  const item = menuItems.find(item => item.eventName === eventName && item.id === id)
            || navigationItems.find(item => item.eventName === eventName && item.id === id)
            || { id: id, eventName: eventName };
  if (eventHandlers[eventName]) {
    eventHandlers[eventName](item, globalData.pointerEvent);
  } else {
    executeEvent('eventName', item, [event, globalData.pointerEvent]);
  }
};

/**
 * èœå•é¡¹ç‚¹å‡»äº‹ä»¶ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰
 */
menuContainer.addEventListener('click', event => {
  const navigation = event.target.closest('.menuNavigation-Content a'); // å¯¼èˆªæ 
  const menuContent = event.target.closest('.menuLoad-Content span'); // èœå•é¡¹
  const targetElement = navigation || menuContent;

  if (targetElement && targetElement.dataset.eventName && targetElement.dataset.id) {
    handleEvent(targetElement.dataset.id, targetElement.dataset.eventName, event);
  }
  // else æ™®é€šé“¾æ¥å‹ æ— éœ€å¤„ç†
});
```

### 3.3 å¤–éƒ¨æ–¹æ³•

å¦‚ 1.1 å°èŠ‚æ‰€è¿°ï¼Œåœ¨è°ƒç”¨å¤–éƒ¨æ–¹æ³•æ—¶ï¼Œç¨‹åºä¼šå°è¯•ä»`window`å¯¹è±¡ä¸­è¯»å–æ‰§è¡Œã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ­¤è°ƒç”¨è¿˜æ”¯æŒç®€å•çš„ç‚¹åˆ†é“¾å¼è°ƒç”¨ã€å‚æ•°ä¼ é€’å’Œæ–‡æœ¬æ›¿æ¢ã€‚å¯¹äºä¸€äº›ç®€å•çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å¸Œæœ›å®ç°å›åˆ°ä¸Šä¸€é¡µï¼Œåªéœ€è¦æ‰§è¡Œ`window.history.back`ï¼Œå› æ­¤åœ¨é…ç½®æ–‡ä»¶ä¸­çš„`eventName`å€¼é‡Œï¼Œå°±å¯ä»¥è¿™æ ·å¡«å†™ã€‚

å…·ä½“è€Œè¨€ï¼Œå¯¹äºä¼ é€’è¿‡æ¥çš„`eventName`å€¼ï¼Œé¦–å…ˆä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ï¼Œå°è¯•è·å–`functionPath`å’Œ`functionArgs`ã€‚

```js
const functionMatch = eventName.match(/^([^\(]+)\((.*)\)$/);

let functionPath, functionArgs;
if (functionMatch) {
  functionPath = functionMatch[1].trim();
  functionArgs = functionMatch[2].split(',').map(arg => arg.trim().replace(/['"]/g, ''));
} else {
  functionPath = eventName.trim();
  functionArgs = [];
}
```

å¦å¤–ï¼Œå¯¹äºé•¿åº¦ä¸ºä¸€çš„å‚æ•°ï¼Œè¿›è¡Œå¦‚ä¸‹æ›¿æ¢ï¼šæ ¹æ®å±æ€§å€¼å°è¯•åŒ¹é…`globalData`[^globalData] çš„é”®å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæƒ³è¦åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€é“¾æ¥ï¼Œå¯ä»¥è¿™æ ·å®šä¹‰ï¼š`eventName: 'window.open(linkAddress)'`ã€‚è€Œå¯¹äºéœ€è¦ä¼ é€’å­—ç¬¦ä¸²çš„è°ƒç”¨ï¼Œå¦‚ç™¾åº¦æœç´¢æˆ–å¿…åº”æœç´¢ï¼Œå¯ä»¥åœ¨å‚æ•°ä¸­ç”¨`##`åŒ…è£¹å¾…æ›¿æ¢çš„å†…å®¹æ¥æ ‡å®šï¼Œä¾‹å¦‚ï¼š

```yaml
# selectedText å°†è¢«æ›¿æ¢ä¸ºé€‰ä¸­æ–‡æœ¬
- {eventName: 'window.open("https://www.bing.com/search?q=##selectedText##")'}
```

[^globalData]: globalData ç›®å‰æä¾›å››ä¸ªå…¬å…±æ•°æ®ï¼š
    ```js
    const globalData = {
      pointerEvent: null,  // å³é”®äº‹ä»¶
      linkAddress: null,   // é“¾æ¥åœ°å€
      selectedText: null,  // é€‰å–æ–‡æœ¬
      inputContent: null   // è¾“å…¥æ¡†
    };
    ```

æœ€åï¼Œå°†`functionPath`æ‹†åˆ†ä¸ºæ•°ç»„ï¼Œé€å±‚è®¿é—®å¯¹è±¡å±æ€§ï¼Œå¹¶è®°å½•ä¸Šä¸€å±‚å¯¹è±¡ï¼Œä»¥ç¡®ä¿åœ¨è°ƒç”¨å‡½æ•°æ—¶æ­£ç¡®è®¾ç½®`this`ã€‚å¦‚æœæœ€ç»ˆè§£æåˆ°çš„`context`æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™ä½¿ç”¨`apply`æ–¹æ³•è°ƒç”¨å®ƒã€‚

```js
const properties = functionPath.split('.');
let context = window;
let parentContext = null;

for (const prop of properties) {
  parentContext = context;
  context = context[prop];
  if (typeof context === 'undefined') {
    return;
  }
}

if (typeof context === 'function') {
  return context.apply(parentContext, [...functionArgs, ...args]);
}
```

### 3.4 å®ç°ä»£ç 

ç»¼ä¸Šæ‰€è¿°ï¼Œå®Œæ•´çš„å®ç°å†…å®¹è¯·å‚è§ä»¥ä¸‹é“¾æ¥ä¸­çš„æ–‡ä»¶ï¼š

{% btns rounded grid3 %}
{% cell rightMenus.js::https://github.com/inkss/volantis/blob/clean/source/js/plugins/rightMenus.js:: %}
{% cell rightmenus layout::https://github.com/inkss/volantis/blob/clean/layout/_plugins/rightmenus/layout.ejs:: %}
{% cell rightmenus config::https://github.com/inkss/volantis/blob/clean/_config.yml#L959-L1031:: %}
{% endbtns %}

## å››ã€é™„å½•å†…å®¹

### 4.1 åŠ¨æ€æ ·å¼

è¯¸å¦‚é˜…è¯»æ¨¡å¼å’Œæ‰“å°æ¨¡å¼çš„åŠŸèƒ½è®¾è®¡ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹é¡µé¢å…ƒç´ æ ·å¼æ¥å®ç°ã€‚ä¾‹å¦‚ï¼Œåœ¨æ‰“å°ç½‘é¡µæ—¶ï¼Œå¯ä»¥é€šè¿‡åª’ä½“æŸ¥è¯¢`media="print"`å¼•å…¥ä¸“ç”¨äºæ‰“å°çš„æ ·å¼æ–‡ä»¶ã€‚

```html
<link rel="stylesheet" href="/css/print.css" media="print">
```

å¯ä»¥åœ¨å¼€å‘è€…å·¥å…·çš„æ ·å¼ç¼–è¾‘å™¨ä¸­ï¼Œå¼€å¯æ¨¡æ‹Ÿ CSS åª’ä½“ç±»å‹çš„åŠŸèƒ½ï¼Œä»¥è°ƒè¯•æ‰“å°æ ·å¼ã€‚

![å¼€å‘è€…å·¥å…·](../../img/article/25-01@è‡ªå®šä¹‰å³é”®é‡æ„ç¯‡/25-01-21_143930.png)

å¯¹äºé˜…è¯»æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡æ§åˆ¶ link æ ‡ç­¾çš„ disabled å±æ€§æ¥å†³å®šæ ·å¼æ˜¯å¦ç”Ÿæ•ˆã€‚

```html
<link id="reading-mode" rel="stylesheet" disabled="true" href="/css/read.css">

<script>
  const readModeStylesheet = document.getElementById('reading-mode');
  readModeStylesheet.disabled = !readModeStylesheet.disabled;
</script>
```

### 4.2 å›¾ç‰‡ç²˜è´´

ä¸€ä¸ªé—®é¢˜ï¼š*å¦‚æœå‰ªè´´æ¿ä¸­æœ‰å›¾ç‰‡ï¼Œå¯ä»¥å°†å…¶ç²˜è´´åˆ°è¾“å…¥æ¡†ï¼ˆè¯„è®ºæ¡†ï¼‰ä¸­å—ï¼Ÿ* 

ä»¥ä¸‹æ˜¯ Artalk è¯„è®ºç³»ç»Ÿä¸­å…³äºå›¾ç‰‡ä¸Šä¼ çš„å¤„ç†å®šä¹‰ï¼š

```ts
const onPaste = (evt: ClipboardEvent) => {
  const files = evt.clipboardData?.files
  if (files?.length) {
    evt.preventDefault()
    uploadFromFileList(files)
  }
}

this.kit.useMounted(() => {
  this.kit.useUI().$textarea.addEventListener('dragover', onDragover)
  this.kit.useUI().$textarea.addEventListener('drop', onDrop)
  this.kit.useUI().$textarea.addEventListener('paste', onPaste)
})
```

åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œç›´æ¥ä¸»åŠ¨è§¦å‘ `paste` äº‹ä»¶æ˜¯ä¸å¯è¡Œçš„ï¼ˆè™½ç„¶åœ¨ Electron ä¸­å¯ä»¥å®ç°ï¼‰ã€‚ä½†æ˜¯æµè§ˆå™¨å…è®¸æ˜¾ç¤ºæ“ä½œæ¥è¯»å–å‰ªè´´æ¿å’Œå¤„ç†ç²˜è´´äº‹ä»¶ã€‚æ°å·§ï¼Œæˆ‘ä»¬æ­¤æ—¶æœ‰ä¸€ä¸ªç”±ç”¨æˆ·ä¸»åŠ¨è§¦å‘çš„èœå•ç‚¹å‡»äº‹ä»¶ã€‚

ç”±äºæ— æ³•ä¿®æ”¹ Artalk çš„å›¾ç‰‡ä¸Šä¼ å®ç°ï¼Œæˆ‘ä»¬éœ€è¦å¦è¾Ÿè¹Šå¾„ï¼šä»å‰ªè´´æ¿è¯»å–å†…å®¹ï¼Œå°†å›¾ç‰‡æ–‡ä»¶æ·»åŠ åˆ° `DataTransfer` å¯¹è±¡ä¸­ï¼Œç„¶ååˆ›å»ºå¹¶è§¦å‘ä¸€ä¸ª `ClipboardEvent`ï¼Œå°† `DataTransfer` å¯¹è±¡ä¸­çš„å†…å®¹ä¼ é€’ç»™è¾“å…¥æ¡†çš„ç²˜è´´äº‹ä»¶ä¸­ã€‚

```js
let imageFiles = [];
for (const item of clipboardItems) {
  for (const type of item.types) {
    if (type.startsWith('image/')) {
      const imageBlob = await item.getType(type);
      const file = new File([imageBlob], 'clipboard-image.png', { type: type });
      imageFiles.push(file);
    } else if (type === 'text/plain') {
      //...
    }
  }
}

for (const file of imageFiles) {
  const dataTransfer = new DataTransfer();
  dataTransfer.items.add(file);
  const pasteEvent = new ClipboardEvent('paste', {
    clipboardData: dataTransfer,
    bubbles: true,
    cancelable: true
  });

  // è¾“å…¥æ¡†è§¦å‘ç²˜è´´äº‹ä»¶
  pointerEvent.target.dispatchEvent(pasteEvent);
}
```
