---
title: è‡ªå®šä¹‰å³é”®é‡æ„ç¯‡
toc: true
indent: true
hiddenTitle: false
tag:
  - è‡ªå®šä¹‰å³é”®èœå•
  - å‰ç«¯å¼€å‘
  - ç½‘ç«™ä¼˜åŒ–
  - JavaScript
categories: åšå®¢
description: >-
  è¿™ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†å¦‚ä½•é€šè¿‡è‡ªå®šä¹‰å³é”®èœå•æ¥æå‡ç”¨æˆ·ä½“éªŒã€‚æ–‡ç« ä»éœ€æ±‚åˆ†æå…¥æ‰‹ï¼Œä»‹ç»äº†å¯¼èˆªæ å’Œèœå•é¡¹çš„åˆ†ç±»åŠåŠŸèƒ½ï¼Œè¯¦ç»†è®²è§£äº†é…ç½®æ–‡ä»¶çš„è®¾ç½®å’Œé¡µé¢ç»˜åˆ¶çš„æµç¨‹ã€‚é€šè¿‡é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼Œè¯»è€…å¯ä»¥å­¦ä¹ åˆ°å¦‚ä½•è®¾è®¡å’Œå®ç°ä¸€ä¸ªé«˜æ•ˆã€ä¼˜é›…çš„è‡ªå®šä¹‰å³é”®èœå•ï¼Œæå‡ç½‘ç«™çš„äº¤äº’æ€§å’Œç”¨æˆ·ä½“éªŒã€‚
date: '2025-01-21 01:20'
updated: '2025-01-21 01:20'
background: ../../img/article/21-07@è‡ªåŠ¨åŒ–åšå®¢éƒ¨ç½²/wallhaven-48o37j.avif
headimg: ../../img/article/25-01@è‡ªå®šä¹‰å³é”®é‡æ„ç¯‡/Hexoåšå®¢å°é¢.png
abbrlink: 4f48cb48
references:
  - title: åŸç”Ÿ JS çš„å³é”®èœå•å®ç°
    url: https://inkss.cn/post/3717f151
---

æ˜¯çš„ï¼Œè‡ªå®šä¹‰å³é”®èœå•å†æ¬¡å°è¯•é‡æ„äº†ã€‚ä¸Šä¸€æ¬¡é‡æ„æ˜¯åœ¨ 2022 å¹´ï¼Œä½†æœ€è¿‘åœ¨å°è¯•ä¿®æ”¹æ—¶å‘ç°ï¼Œç›®å‰å®ç°é€»è¾‘è¿‡äºå¤æ‚ä¸”ä¸å¤Ÿä¼˜é›…ï¼ŒåŒæ—¶ç”±äºç¼ºä¹åˆé€‚çš„æ³¨é‡Šï¼ŒèŠ±äº†ä¸å°‘æ—¶é—´æ‰ç†æ¸…è°ƒç”¨å…³ç³»ï¼Œ{% emoji kulou %} æƒ­æ„§ã€‚

<!-- more -->

å› æ­¤ï¼Œå†³å®šæ¨å€’é‡æ¥ï¼Œé‡æ–°è®¾è®¡ã€‚{% emoji family-exam %}

## ä¸€ã€éœ€æ±‚åˆ†æ

èœå•ç±»å‹åˆ†ä¸ºä¸¤ç±»ï¼šå¯¼èˆªæ å’Œèœå•é¡¹ã€‚å¯¼èˆªæ ï¼šä½äºé¡¶éƒ¨ï¼ˆç±»ä¼¼ç«ç‹æµè§ˆå™¨çš„å³é”®èœå•ï¼‰ï¼Œé‡‡ç”¨æ¨ªå‘å¸ƒå±€ï¼Œä»…æ˜¾ç¤ºå›¾æ ‡ã€‚èœå•é¡¹ï¼šé‡‡ç”¨ç«–å‘å¸ƒå±€ï¼Œæ˜¾ç¤ºå›¾æ ‡å’Œèœå•åç§°ï¼Œå¯¹åº”ä¸€èˆ¬çš„æ™®é€šèœå•ã€‚

åŠŸèƒ½ä¸Šä¹Ÿå¯åˆ†ä¸ºä¸¤ç±»ï¼šé“¾æ¥å‹èœå•å’Œäº‹ä»¶å‹èœå•ã€‚é“¾æ¥å‹èœå•ï¼šè®°å½•ç½‘å€å’Œé“¾æ¥ç±»å‹ï¼Œä¾‹å¦‚ï¼šå›åˆ°é¦–é¡µã€æŸ¥çœ‹ç•™è¨€æ¿é¡µé¢ã€‚äº‹ä»¶å‹èœå•ï¼šéœ€è¦æ‰§è¡Œå‡½æ•°çš„èœå•é¡¹ï¼Œä¾‹å¦‚ï¼šå¤åˆ¶æ–‡æœ¬ã€æ‰“å°é¡µé¢ã€‚

è¯¦ç»†åˆ†æè§ä¸‹é¢çš„æ€ç»´å¯¼å›¾ï¼š

![å³é”®èœå•æ€ç»´å¯¼å›¾](../../img/article/25-01@è‡ªå®šä¹‰å³é”®é‡æ„ç¯‡/å³é”®èœå•.svg)

### 1.1 é…ç½®æ–‡ä»¶

```yaml Hexo é…ç½®æ–‡ä»¶ç¤ºä¾‹
rightmenus:
  enable: true
  options:
    navigation: true # æ˜¯å¦æ˜¾ç¤ºå¯¼èˆªæ ç»„ä»¶
    maxMenuItems: 12 # æœ€å¤§èœå•æ˜¾ç¤ºæ•°é‡
  navigation: 
    - { menuItem }
  menuList:
    - { menuItem }
```

`navigation` å’Œ `menuList` å­—æ®µçš„å®šä¹‰é¡ºåºå†³å®šäº†èœå•åŠ è½½çš„æ˜¾ç¤ºé¡ºåºã€‚åœ¨ `options` ä¸­ï¼Œ`navigation` æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºå¯¼èˆªæ ç»„ä»¶ï¼›å½“æ»¡è¶³æ¡ä»¶çš„èœå•é¡¹æ•°é‡è¶…è¿‡ `maxMenuItems` æ—¶ï¼Œéšè—æ‰€æœ‰é“¾æ¥å‹èœå•ã€‚åœ¨ `menuList` èœå•é¡¹ä¸­ï¼Œå¦‚æœç›¸é‚»èœå•é¡¹çš„ `displayCondition` å€¼ä¸åŒï¼Œåˆ™è‡ªåŠ¨æ·»åŠ åˆ†å‰²çº¿ã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®šä¹‰èœå•åˆ†å‰²çº¿ï¼Œæ­¤æ—¶è‡ªåŠ¨åˆ¤æ–­ä¼šå…³é—­ï¼Œå¹¶åœ¨å®šä¹‰çš„ä½ç½®æ·»åŠ åˆ†å‰²çº¿ã€‚

```code èœå•åˆ†å‰²çº¿å®šä¹‰æ–¹å¼
hr, {}, {id: 'hr'}
```

å¯¹äº eventName å’Œ displayCondition çš„å€¼ï¼Œå³é”®èœå•å‡½æ•°ä¼šé¢„è®¾ä¸€äº›äº‹ä»¶å’Œåˆ¤æ–­å‡½æ•°ã€‚åœ¨è¿›è¡Œèœå•é¡¹åˆ¤æ–­æˆ–ç‚¹å‡»äº‹ä»¶è§¦å‘æ—¶ï¼Œé¦–å…ˆä¼šæ£€æŸ¥å³é”®èœå•å‡½æ•°ä¸­æ˜¯å¦å­˜åœ¨ç›¸åº”çš„å®ç°ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šåœ¨ window ä¸Šå°è¯•è°ƒç”¨ï¼ŒåŒæ—¶ä¼ é€’ menuItem[^1]ã€event å’Œ pointevent å€¼ã€‚å…·ä½“çš„è°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š

[^1]: æ³¨ï¼šæ­¤å¤„ `menuItem` å¯¹è±¡æœªåŒ…å«æ•°æ®ç»„æˆä¸­çš„ `name, icon` å±æ€§ï¼Œä½†é¢å¤–æä¾›ä¸¤ä¸ªå±æ€§ï¼š
    ```js
    {
      isHrElement: 'æ˜¯å¦ä¸ºèœå•åˆ†å‰²é¡¹',
      menuContentElement: 'èœå•é¡¹æ‰€å¯¹åº” DOM èŠ‚ç‚¹'
    }
    ```

```js eventName
/**
 * åœ¨ window ä¸Šå°è¯•æŒ‰ç…§ eventName å€¼è°ƒç”¨å‡½æ•°
 * 
 * @param {Object} menuItem èœå•é¡¹
 * @param {Event} event ç‚¹å‡»äº‹ä»¶
 * @param {PointerEvent} pointevent å³é”®äº‹ä»¶
 */
window[eventName](menuItem, event, pointevent)()
```

```js displayCondition
/**
 * åœ¨ window ä¸Šå°è¯•æŒ‰ç…§ displayCondition å€¼è°ƒç”¨å‡½æ•°
 * 
 * @param {Object} menuItem èœå•é¡¹
 * @param {PointerEvent} pointevent å³é”®äº‹ä»¶
 * @returns {boolean} - true/false æ˜¯å¦å…è®¸å½“å‰èœå•é¡¹æ˜¾ç¤º
 */
window[displayCondition](menuItem, pointevent)()
```

è¯¥è°ƒç”¨æ”¯æŒç®€å•çš„ç‚¹åˆ†é“¾å¼è°ƒç”¨ã€å‚æ•°ä¼ é€’å’Œæ–‡æœ¬æ›¿æ¢ã€‚è¯¦ç»†çš„å®ç°é€»è¾‘è¯·è§ä¸‹æ–‡ã€‚

```yaml ä½¿ç”¨ç¤ºä¾‹
- { eventName: 'readMode' } # å†…éƒ¨äº‹ä»¶ï¼šåˆ‡æ¢é˜…è¯»æ¨¡å¼
- { eventName: 'window.location.reload' }  # åˆ·æ–°é¡µé¢
- { eventName: 'volantis.dark.toggle' } # åˆ‡æ¢æ·±è‰²æ¨¡å¼
- { eventName: 'window.open(linkAddress)' } # æ–°æ ‡ç­¾é¡µæ‰“å¼€é“¾æ¥
- { eventName: 'OpenSearch(selectedText)' } # æ‰“å¼€æœç´¢é¡µé¢ï¼Œå¹¶ä¼ é€’å½“å‰é€‰ä¸­æ–‡æœ¬
- { eventName: 'window.open("https://www.bing.com/search?q=##selectedText##")' } # å¿…åº”æœç´¢
```

ç”±äºä¼ é€’å‚æ•°çš„æ•°é‡ä¸å®šï¼Œå¤–éƒ¨å‡½æ•°å¦‚æœ‰éœ€è¦ï¼Œå»ºè®®ä½¿ç”¨ `...args` æ¥æ”¶å‚æ•°ã€‚

```js ç¨‹åºçš„å®é™…è°ƒç”¨æ–¹å¼
// context: æ‰§è¡Œå‡½æ•°å
// functionArgs: eventName å®šä¹‰æ—¶çš„å†…éƒ¨å·²æœ‰å‚æ•°
// args: menuItem, (event), pointEvent
context.apply(parentContext, functionArgs.concat(args));
```

### 1.2 é¡µé¢ç»˜åˆ¶

menuItem ä¸­çš„å±æ€§å°†ä»¥ `data-xxxx` æ ¼å¼å†™å…¥åˆ°èœå•é¡¹çš„ HTML å…ƒç´ ä¸Šã€‚

```html ä¾‹å¤–å±æ€§ï¼š linkTarget â¡ target, link â¡ href
<% if(item.link === undefined) { %>
  <li class="menuLoad-Content">
    <span class="vlts-menu" data-id="<%- item.id %>" data-event-name="<%= item.eventName %>"
      data-display-condition="<%- item.displayCondition %>">
      <i class="<%- item.icon %>"></i>
      <%- item.name %>
    </span>
  </li>
<% } else { %>
  <% if(!item.linkTarget) item.linkTarget = '_self' %>
  <li class="menuLoad-Content">
    <a class="vlts-menu" data-id="<%- item.id %>" href="<%- item.link %>" 
    target="<%- item.linkTarget %>" data-display-condition="<%- item.displayCondition %>">
      <i class="<%- item.icon %>"></i>
      <%- item.name %>
    </a>
  </li>
<% } %>
```

## äºŒã€æµç¨‹è®¾è®¡

å¤§è‡´å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š

ğŸ‘ ä½¿ç”¨å³é”®é€‰æ‹©å™¨åœ¨é¡µé¢ä¸­æ‰¾åˆ° HTML å…ƒç´ ã€‚

ğŸ™Œ å¦‚æœæ‰¾åˆ°ï¼Œåˆ™è¯»å–æ‰€æœ‰å¯¼èˆªæ å’Œèœå•é¡¹**èµ‹å€¼**å­˜å‚¨ã€‚

ğŸ¤² è¦†ç›–æµè§ˆå™¨é»˜è®¤çš„å³é”®èœå•ï¼Œ**ç»˜åˆ¶**èœå•é¡¹å¹¶æ˜¾ç¤ºè‡ªå®šä¹‰å³é”®èœå•ã€‚

ğŸ™ ä¸ºå³é”®èœå•ç‚¹å‡»äº‹ä»¶æ·»åŠ äº‹ä»¶å§”æ‰˜ï¼Œè§¦å‘ç›¸åº”**äº‹ä»¶**ã€‚

ğŸ¤ Pjax å…¼å®¹**å›è°ƒ**ã€‚

### 2.1 èµ‹å€¼

```js
const menuContainer = document.querySelector(menuSelector)
const maxMenuItems = Number(menuContainer.dataset.maxMenuItems)
```

{% tabs tab-1 %}

<!-- tab å³é”®å¯¼èˆªé¡¹ -->

```js
const navigationItems = Array.from(
        menuContainer.querySelectorAll('.menuNavigation-Content a'))
  .map(item => ({
    id: item.dataset.id || item.id,
    displayCondition: item.dataset.displayCondition,
    menuContentElement: item
  }));
```

<!-- endtab -->

<!-- tab å³é”®èœå•é¡¹   -->

```js
const menuItems = Array.from(menuContainer.querySelectorAll('.menuLoad-Content'))
  .flatMap(item => {
    const elem = item.firstElementChild;
    if (elem) {
      return [{
        link: elem.href,
        id: elem.dataset.id || elem.id,
        linkTarget: elem.target || elem.dataset.linkTarget,
        eventName: elem.dataset.eventName,
        displayCondition: elem.dataset.displayCondition,
        isHrElement: elem.tagName === 'HR',
        menuContentElement: item
      }];
    }
    return [];
  });
```

<!-- endtab -->

{% endtabs %}

### 2.2 ç»˜åˆ¶

```js ç®€æ˜“æµç¨‹å±•ç¤º
const conditions = {
  inInputField: () => {},
  selectedText: () => {},
  onImage: () => {},
  onLink: () => {},
  articlePage: () => {},
  scrolledFromTop: () => {},
  homePage: () => {}
};

const evaluateCondition = (menuItem, pointerEvent) => {
  if (conditions[menuItem.displayCondition]) {
    return conditions[menuItem.displayCondition](menuItem, pointerEvent);
  }
};

const showCustomContextMenu = (pointerEvent) => {
  menuItems.forEach(item => {
    if (evaluateCondition(item, pointerEvent)) {
      item.menuContentElement.classList.add('active');
    } else {
      item.menuContentElement.classList.remove('active');
    }
  })
};

const positionMenu = (pointerEvent) => {
  pointerEvent.preventDefault();
  showCustomContextMenu(pointerEvent);

  menuContainer.classList.add('active');
  menuContainer.style.left = `${posX}px`;
  menuContainer.style.top = `${posY}px`;
}

document.addEventListener('contextmenu', (pointerEvent) => {
  positionMenu(pointerEvent)
})
```

### 2.3 äº‹ä»¶

{% codeblock lang:js ç®€æ˜“æµç¨‹å±•ç¤º %}
const eventHandlers = {
  // é¢„è®¾äº‹ä»¶
}

const handleEvent = (id, eventName, event) => {
  if (eventHandlers[eventName]) {
    eventHandlers[eventName](item, globalData.pointerEvent);
  }
};

menuContainer.addEventListener('click', event => {
  const navigation = event.target.closest('.menuNavigation-Content a'); // å¯¼èˆªæ 
  const menuContent = event.target.closest('.menuLoad-Content span'); // èœå•é¡¹
  const targetElement = navigation || menuContent;

  if (targetElement && targetElement.dataset.eventName && targetElement.dataset.id) {
    handleEvent(targetElement.dataset.id, targetElement.dataset.eventName, event);
  }
  // else æ™®é€šé“¾æ¥å‹ æ— éœ€å¤„ç†
});
{% endcodeblock %}

### 2.4 å›è°ƒ

```js
document.addEventListener("pjax:send", hideContextMenu);
```

## ä¸‰ã€åŠŸèƒ½å®ç°

å®Œæ•´çš„å®ç°å†…å®¹è¯·è§å¦‚ä¸‹é“¾æ¥ï¼Œå…·ä½“åˆ†æå¾…æ—¥åè¡¥å……ï¼ˆ{% emoji shuizhuo %}ï¼‰ã€‚

{% link source/js/plugins/rightMenus.js, https://github.com/inkss/volantis/blob/clean/source/js/plugins/rightMenus.js %}